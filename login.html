<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="login.css">
    <title>Document</title>
    <style>
        .error { color: red; }
    </style>
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <!-- Video Section -->
        <div class="col-md-6 video-section">
            <iframe src="https://www.youtube.com/embed/ktlfwnEvJQE?si=iXu9_O3zn4kw_LVo&autoplay=1&loop=1&playlist=ktlfwnEvJQE&mute=1"
            frameborder="0" 
            allow="autoplay; fullscreen" 
            class="img-fluid" 
            style="width: 100%; height: 100%;">
            </iframe>
        </div>
        <!-- Form Section -->
        <div class="col-md-6 d-flex justify-content-center align-items-center">
            <div class="main">
                <input type="checkbox" id="chk" aria-hidden="true">
                <div class="signup">
                    <form id="signup-form">
                        <label for="chk" aria-hidden="true">Sign up</label>
                        <div class="signup_input">
                            <input type="text" name="username" placeholder="User name" id="signup-username">
                            <span id="signup-username-error" class="error"></span>
                            <input type="email" name="email" placeholder="Email" id="signup-email">
                            <span id="signup-email-error" class="error"></span>
                            <input type="password" name="password" placeholder="Password" id="signup-password">
                            <span id="signup-password-error" class="error"></span>
                            <button type="submit">Sign Up</button>
                        </div>
                    </form>
                </div>
                <div class="login">
                    <form id="login-form">
                        <label for="chk" aria-hidden="true">Login</label>
                        <div class="login_input">
                            <input type="text" name="username" placeholder="Username" id="login-username">
                            <span id="login-username-error" class="error"></span>
                            <input type="password" name="password" placeholder="Password" id="login-password">
                            <span id="login-password-error" class="error"></span>
                            <button type="submit">Login</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="login.js"></script>
<script>
    // Function to validate password strength
function isStrongPassword(password) {
    const passwordPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
    return passwordPattern.test(password);
}

// Handle Sign Up
document.getElementById('signup-form').addEventListener('submit', async function(event) {
    event.preventDefault();

    const username = document.getElementById('signup-username').value.trim();
    const email = document.getElementById('signup-email').value.trim();
    const password = document.getElementById('signup-password').value.trim();

    // Clear previous error messages
    document.getElementById('signup-username-error').textContent = '';
    document.getElementById('signup-email-error').textContent = '';
    document.getElementById('signup-password-error').textContent = '';

    // Validate form
    let isValid = true;

    if (username === '') {
        document.getElementById('signup-username-error').textContent = 'Username is required.';
        isValid = false;
    } else if (username.length < 3) {
        document.getElementById('signup-username-error').textContent = 'Username must be at least 3 characters long.';
        isValid = false;
    }

    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (email === '') {
        document.getElementById('signup-email-error').textContent = 'Email is required.';
        isValid = false;
    } else if (!emailPattern.test(email)) {
        document.getElementById('signup-email-error').textContent = 'Enter a valid email address.';
        isValid = false;
    }

    if (!isStrongPassword(password)) {
        document.getElementById('signup-password-error').textContent = 'Password must be at least 8 characters long, contain at least one uppercase letter, one lowercase letter, one number, and one special character.';
        isValid = false;
    }

    if (isValid) {

        // Save user to local storage
        const user = { username, email, password, cart : [] };

        var x = JSON.parse(localStorage.getItem('users')) || [];

        x.push(user);

        localStorage.setItem('users', JSON.stringify(x));

        alert('Sign up successful');
        
    }
});

// Handle Login
// Handle Login
document.getElementById('login-form').addEventListener('submit', async function(event) {
    event.preventDefault();

    const username = document.getElementById('login-username').value.trim();
    const password = document.getElementById('login-password').value.trim();

    // Clear previous error messages
    document.getElementById('login-username-error').textContent = '';
    document.getElementById('login-password-error').textContent = '';

    var x = JSON.parse(localStorage.getItem('users')) || [];

    var user = x.find(user => user.username === username && user.password === password);

    if(user)
    {
        
        alert('Login successful');
        
        localStorage.setItem('currentUser', user.email);

    }
    else
    {
        document.getElementById('login-username-error').textContent = 'Invalid username or password';
    }

    // try {
    //     // Fetch users from json-server
    //     const response = await fetch(`http://localhost:3000?username=${username}&password=${password}`);
    //     const users = await response.json();

    //     // Check if any user was found with the provided credentials
    //     if (users.length > 0) {
    //         alert('Login successful');
    //         window.location.href = 'ecommerce/main.html';
    //     } else {
    //         document.getElementById('login-username-error').textContent = 'Invalid username or password';
    //     }
    // } catch (error) {
    //     console.error('Error:', error);
    //     document.getElementById('login-username-error').textContent = 'Error logging in';
    // }


    // // Clear previous error messages
    // document.getElementById('login-username-error').textContent = '';
    // document.getElementById('login-password-error').textContent = '';

    // try {
    //     const response = await fetch(`http://localhost:3000/users?username=${username}&password=${password}`);
    //     const users = await response.json();

    //     if (users.length > 0) {
    //         alert('Login successful');
    //         window.location.href = 'main.html';
    //     } else {
    //         document.getElementById('login-username-error').textContent = 'Invalid username or password';
    //     }
    // } catch (error) {
    //     console.error('Error:', error);
    //     document.getElementById('login-username-error').textContent = 'Error logging in';
    // }
});

</script>
</body>
</html>
